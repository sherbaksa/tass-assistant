{% extends 'base.html' %}
{% block content %}
<h1>{{ title }}</h1>

<p class="page__intro">
  –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞–º–∏ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –Ω–æ–≤–æ—Å—Ç–µ–π. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤, –º–æ–¥–µ–ª–∏ –∏ –Ω–∞–∑–Ω–∞—á—å—Ç–µ –∏—Ö –Ω–∞ —ç—Ç–∞–ø—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏.
</p>

<div class="cards-grid">
  <!-- –ü—Ä–æ–≤–∞–π–¥–µ—Ä—ã -->
  <div class="card">
    <h2 class="card__title">üîå –ü—Ä–æ–≤–∞–π–¥–µ—Ä—ã API</h2>
    <p class="card__sub">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞–º–∏ AI (OpenAI, Google, Anthropic)</p>

    <div class="stats">
      <div class="stat">
        <span class="stat__value">{{ providers|length }}</span>
        <span class="stat__label">–≤—Å–µ–≥–æ</span>
      </div>
      <div class="stat">
        <span class="stat__value">{{ providers|selectattr('is_active')|list|length }}</span>
        <span class="stat__label">–∞–∫—Ç–∏–≤–Ω—ã—Ö</span>
      </div>
      <div class="stat">
        <span class="stat__value">{{ providers|selectattr('api_key')|list|length }}</span>
        <span class="stat__label">—Å –∫–ª—é—á–∞–º–∏</span>
      </div>
    </div>

    <a href="{{ url_for('assistants.providers') }}" class="btn btn--primary">
      –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤
    </a>
  </div>

  <!-- –ú–æ–¥–µ–ª–∏ -->
  <div class="card">
    <h2 class="card__title">ü§ñ –ú–æ–¥–µ–ª–∏ AI</h2>
    <p class="card__sub">–ü—Ä–æ—Å–º–æ—Ç—Ä –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏ –º–æ–¥–µ–ª—è–º–∏</p>

    <div class="stats">
      {% set total_models = providers|map(attribute='models')|map('list')|sum(start=[])|length %}
      {% set active_models = providers|selectattr('is_active')|map(attribute='models')|map('list')|sum(start=[])|selectattr('is_active')|list|length %}

      <div class="stat">
        <span class="stat__value">{{ total_models }}</span>
        <span class="stat__label">–≤—Å–µ–≥–æ</span>
      </div>
      <div class="stat">
        <span class="stat__value">{{ active_models }}</span>
        <span class="stat__label">–∞–∫—Ç–∏–≤–Ω—ã—Ö</span>
      </div>
    </div>

    <a href="{{ url_for('assistants.models') }}" class="btn btn--primary">
      –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ–¥–µ–ª—è–º–∏
    </a>
  </div>

  <!-- –≠—Ç–∞–ø—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏ -->
  <div class="card">
    <h2 class="card__title">‚öôÔ∏è –≠—Ç–∞–ø—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏</h2>
    <p class="card__sub">–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π –Ω–∞ —ç—Ç–∞–ø—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏ –Ω–æ–≤–æ—Å—Ç–µ–π</p>

    <div class="stages-preview">
      {% for stage in stages %}
        <div class="stage-item">
          <span class="stage-item__name">{{ stage.display_name }}</span>
          {% set assignment = stage.assignments.filter_by(is_active=True).first() %}
          {% if assignment %}
            <span class="badge badge--success">{{ assignment.model.display_name }}</span>
          {% else %}
            <span class="badge badge--warning">–ù–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∞</span>
          {% endif %}
        </div>
      {% endfor %}
    </div>

    <a href="{{ url_for('assistants.stages') }}" class="btn btn--primary">
      –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —ç—Ç–∞–ø—ã
    </a>
  </div>
</div>
{% endblock %}