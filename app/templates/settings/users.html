{% extends 'base.html' %}
{% block content %}
<h1>{{ title }}</h1>

<div class="card" style="border-color: var(--warn);">
  <h2 class="card__title">üîê –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–µ–π</h2>
  <p class="card__sub">
    –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å:
    <strong style="color: {% if config.REGISTRATION_ENABLED %}var(--ok){% else %}var(--err){% endif %};">
      {% if config.REGISTRATION_ENABLED %}–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ—Ç–∫—Ä—ã—Ç–∞{% else %}–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∑–∞–∫—Ä—ã—Ç–∞{% endif %}
    </strong>
  </p>
  <form action="{{ url_for('settings.toggle_registration') }}" method="post">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
    <button type="submit" class="btn {% if config.REGISTRATION_ENABLED %}btn--muted{% else %}btn--admin{% endif %}">
      {% if config.REGISTRATION_ENABLED %}üîí –û—Ç–∫–ª—é—á–∏—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é{% else %}üîì –í–∫–ª—é—á–∏—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é{% endif %}
    </button>
  </form>
</div>

<div class="card">
  <h2 class="card__title">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–∏—Å—Ç–µ–º—ã</h2>
  <p class="card__sub">–í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: {{ users|length }}</p>

  <table class="table">
    <thead>
      <tr>
        <th>ID</th>
        <th>Email</th>
        <th>–ê–∫—Ç–∏–≤–µ–Ω</th>
        <th>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</th>
        <th>–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</th>
        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
      </tr>
    </thead>
    <tbody>
      {% for user in users %}
      <tr>
        <td>{{ user.id }}</td>
        <td>
          {{ user.email }}
          {% if user.id == current_user.id %}
            <span class="badge">–≤—ã</span>
          {% endif %}
        </td>
        <td>
          {% if user.is_active %}
            <span style="color: var(--ok);">‚úì –î–∞</span>
          {% else %}
            <span style="color: var(--err);">‚úó –ù–µ—Ç</span>
          {% endif %}
        </td>
        <td>
          {% if user.is_admin %}
            <span style="color: var(--ok);">‚úì –î–∞</span>
          {% else %}
            <span style="color: var(--tass-muted);">‚úó –ù–µ—Ç</span>
          {% endif %}
        </td>
        <td style="color: var(--tass-muted);">
          {{ user.created_at.strftime('%d.%m.%Y %H:%M') if user.created_at else '‚Äî' }}
        </td>
        <td>
  {% if user.id != current_user.id %}
  <!-- –§–æ—Ä–º–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ -->
  <form action="{{ url_for('settings.toggle_admin', user_id=user.id) }}" method="post" style="display:inline;">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
    <button type="submit" class="btn btn--muted" style="padding: 6px 12px; font-size: 14px;">
      {% if user.is_admin %}–£–±—Ä–∞—Ç—å –ø—Ä–∞–≤–∞{% else %}–ù–∞–∑–Ω–∞—á–∏—Ç—å –∞–¥–º–∏–Ω–æ–º{% endif %}
    </button>
  </form>

  <!-- –û—Ç—Å—Ç—É–ø –º–µ–∂–¥—É –∫–Ω–æ–ø–∫–∞–º–∏ -->
  <span style="display:inline-block; width:8px;"></span>

  <!-- –§–æ—Ä–º–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ -->
  <form action="{{ url_for('settings.toggle_active', user_id=user.id) }}" method="post" style="display:inline;">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
    <button type="submit" class="btn {% if user.is_active %}btn--muted{% else %}btn--admin{% endif %}" style="padding: 6px 12px; font-size: 14px;">
      {% if user.is_active %}–î–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å{% else %}–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å{% endif %}
    </button>
  </form>
  {% else %}
  <span style="color: var(--tass-muted);">‚Äî</span>
  {% endif %}
</td>

      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<p style="margin-top: 20px;">
  <a href="{{ url_for('settings.index') }}" class="btn btn--muted">‚Üê –ù–∞–∑–∞–¥ –∫ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º</a>
</p>

{% endblock %}